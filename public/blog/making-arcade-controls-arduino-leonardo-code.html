<!doctype html>
<html lang="en">
<head>
  <meta name="viewport" content="initial-scale=1">
  <link rel="icon" type="image/png" href="/icons/icon-64.png">
  <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed">
  <title>Qubyte Codes - Making arcade controls: Arduino Leonardo code</title>
  <script src="/index.js" async></script>
  <link href="/main-8e8bec617709cd84f8cd6c36ae3724c0.css" rel="stylesheet">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#f1e7cd">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@qubyte">
  <meta name="twitter:title" content="Making arcade controls: Arduino Leonardo code">
  <meta name="twitter:description" content="I&#x27;ve been making an arcade stick lately, and needed to add the electronics. I opted to use ab arduino Leonardo, and the code was surprisingly short.">
</head>
<body>
  <header class="top-header">
    <h1><a href="/">Qubyte Codes</a></h1>
    <nav>
      <ul>
        <li><a href="/">archive</a></li>
        <li><a href="/about">about</a></li>
      </ul>
    </nav>
  </header>
  <div class="content">
    <article class="h-entry">
      <header>
        <h2><a href="https://qubyte.codes/blog/making-arcade-controls-arduino-leonardo-code" class="u-url p-name">Making arcade controls: Arduino Leonardo code</a></h2>
        <time datetime="2017-05-01T00:00Z" class="dt-published">Mon May 01 2017</time>
        <span class="tags"><a href="/tags/arduino">#arduino</a> <a href="/tags/cplusplus">#cplusplus</a> </span>
      </header>
      <div class="e-content">
        <p>I recently got it into my head that I wanted to build an arcade control panel
from parts. Specifically, an 8 way digital joystick and a bunch of buttons. How
it&#39;ll look when finished isn&#39;t important at the moment. It&#39;s enough now to say
that there&#39;ll be a joystick, six regular buttons, and two buttons for start and
select use.</p>
<p>I decided to use an Arduino Leonardo to accept inputs from the buttons and
stick. The Leonardo presents itself as a keyboard to the machine you plug it
into, which is perfect for this. The only thing I needed to do is to initialize
the pins on the Arduino as inputs with inline resistance, and bind them to the
desired keys.</p>
<p>Usually when a programmer thinks &quot;the only thing I need to do&quot;, what follows is
three or four times as much effort as predicted. I was surprised this time that
the effort required was so low, particularly given that I&#39;ve not written any
C/C++ in years. In addition to functions for setting key states, <code>keyboard.h</code>
provides a bunch of useful constants for special keys.</p>
<pre><code class="lang-cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Keyboard.h&gt;</span></span>

<span class="hljs-comment">// MAMEish. An array of pin-key pairs.</span>
<span class="hljs-class"><span class="hljs-keyword">struct</span> {</span> <span class="hljs-keyword">int</span> pin; <span class="hljs-keyword">int</span> key; } pinkeys[] = {
  { <span class="hljs-number">2</span>,  KEY_LEFT_ARROW  },
  { <span class="hljs-number">3</span>,  KEY_UP_ARROW    },
  { <span class="hljs-number">4</span>,  KEY_RIGHT_ARROW },
  { <span class="hljs-number">5</span>,  KEY_DOWN_ARROW  },
  { <span class="hljs-number">6</span>,  KEY_LEFT_CTRL }, <span class="hljs-comment">// Fire 1</span>
  { <span class="hljs-number">7</span>,  KEY_LEFT_ALT  }, <span class="hljs-comment">// Fire 2</span>
  { <span class="hljs-number">8</span>,  <span class="hljs-string">' '</span> },           <span class="hljs-comment">// Fire 3</span>
  { <span class="hljs-number">9</span>,  <span class="hljs-string">'a'</span> },           <span class="hljs-comment">// Fire 4</span>
  { <span class="hljs-number">10</span>, <span class="hljs-string">'s'</span> },           <span class="hljs-comment">// Fire 5</span>
  { <span class="hljs-number">11</span>, <span class="hljs-string">'q'</span> },           <span class="hljs-comment">// Fire 6</span>
  { A0, <span class="hljs-string">'1'</span> },           <span class="hljs-comment">// start</span>
  { A1, KEY_ESC }        <span class="hljs-comment">// select</span>
};

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-comment">// Set all used pins to handle input</span>
  <span class="hljs-comment">// from arcade buttons.</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> <span class="hljs-keyword">const</span> &amp;pinkey : pinkeys) {
    pinMode(pinkey.pin, INPUT_PULLUP);
  }

  <span class="hljs-comment">// Initialize keyboard.</span>
  Keyboard.begin();
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-comment">// For each pin-key pair, check the</span>
  <span class="hljs-comment">// state of the pin and set the</span>
  <span class="hljs-comment">// associated key state to match.</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> <span class="hljs-keyword">const</span> &amp;pinkey : pinkeys) {
    <span class="hljs-keyword">if</span> (digitalRead(pinkey.pin) == LOW) {
      Keyboard.press(pinkey.key);
    } <span class="hljs-keyword">else</span> {
      Keyboard.release(pinkey.key);
    }
  }
}
</code></pre>
<p>Since the Arduino is programmed in a dialect of recent  C++, range-based for
loops are available, as is type inference with <code>auto</code>. This meant I could use an
array of instances of an anonymous structure to express the pin-key pairs. Not a
<code>sizeof</code> in sight!</p>

      </div>
    </article>
    <footer>
      <p>Feel like sharing? <a target="_blank" rel="noopener" href="https://twitter.com/intent/tweet?via=qubyte&amp;text=Qubyte%20Codes%20-%20Making%20arcade%20controls%3A%20Arduino%20Leonardo%20code&amp;url=https://qubyte.codes/blog/making-arcade-controls-arduino-leonardo-code&amp;hashtags=arduino,cplusplus">Tweet this post!</a> or <a target="_blank" rel="noopener" href="web+mastodon://share?text=Qubyte%20Codes%20-%20Making%20arcade%20controls%3A%20Arduino%20Leonardo%20code%20via%20%40qubyte%40mastodon.social%20%23arduino%20%23cplusplus%20https%3A%2F%2Fqubyte.codes%2Fblog%2Fmaking-arcade-controls-arduino-leonardo-code">toot it!</a></p>
      <p>Comments or corrections? <a target="_blank" rel="noopener" href="https://twitter.com/intent/tweet?screen_name=qubyte">Send me a tweet!</a> or <a target="_blank" rel="noopener" href="web+mastodon://share?text=%40qubyte%40mastodon.social">toot to me!</a></p>
    </footer>
  </div>
</body>
</html>
