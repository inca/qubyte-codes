<!doctype html>
<html lang="en">
<head>
  <meta name="viewport" content="initial-scale=1">
  <link rel="icon" type="image/png" href="/icons/icon-64.png">
  <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed">
  <title>Qubyte Codes - Interfaces for JavaScript</title>
  <script src="/index.js" async></script>
  <link href="/main-0d9985ebbfcfd22aeeefc7c031ae0739.css" rel="stylesheet">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#f1e7cd">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@qubyte">
  <meta name="twitter:title" content="Interfaces for JavaScript">
  <meta name="twitter:description" content="It&#x27;s unwise to use instanceof in production code, but it can be very handy for unit testing. I show how it&#x27;s not possible to tweak instanceof to make it even more useful for tests.">
</head>
<body>
  <header class="top-header">
    <h1><a href="/">Qubyte Codes</a></h1>
    <nav>
      <ul>
        <li><a href="/">archive</a></li>
        <li><a href="/about">about</a></li>
      </ul>
    </nav>
  </header>
  <div class="content">
    <article class="h-entry">
      <header>
        <h2><a href="https://qubyte.codes/blog/interfaces-for-javascript" class="u-url p-name">Interfaces for JavaScript</a></h2>
        <time datetime="2016-03-13T10:45Z" class="dt-published">Sun Mar 13 2016</time>
        <span class="tags"><a href="/tags/JavaScript">#JavaScript</a> </span>
      </header>
      <div class="e-content">
        <p>I use <code>instanceof</code> a lot in JavaScript. It&#39;s very handy when writing unit tests. It&#39;s easier to do
an <code>instanceof</code> check than it is to exhaustively probe an object.</p>
<p>Unfortunately <code>instanceof</code> usually means an object has been constructed. If the constructed object
is coming from a third party library, or there is no access to the constructor, it can become
fiddly.</p>
<p>This is why I&#39;m excited about ES2015s <code>Symbol.hasInstance</code>. It allows you to tune the behaviour of
<code>instanceof</code> for a class. Here&#39;s a minimal example of an <em>interface class</em>:</p>
<pre><code class="lang-javascript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PositiveInteger</span> </span>{
  <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'PositiveInteger is an interface class.'</span>);
  }

  <span class="hljs-keyword">static</span> [<span class="hljs-built_in">Symbol</span>.hasInstance](value) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value !== <span class="hljs-string">'number'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">if</span> (value &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">return</span> value % <span class="hljs-number">1</span> === <span class="hljs-number">0</span>;
  }
}

assert.ok(<span class="hljs-number">10</span> <span class="hljs-keyword">instanceof</span> PositiveInteger);   <span class="hljs-comment">// does not throw</span>
assert.ok(<span class="hljs-number">-10</span> <span class="hljs-keyword">instanceof</span> PositiveInteger);  <span class="hljs-comment">// throws</span>
assert.ok(<span class="hljs-string">'hi'</span> <span class="hljs-keyword">instanceof</span> PositiveInteger); <span class="hljs-comment">// throws</span>
<span class="hljs-keyword">var</span> positiveInt = <span class="hljs-keyword">new</span> PositiveInteger();    <span class="hljs-comment">// throws</span>
</code></pre>
<p>The class above exists <em>only</em> to provide this <code>instanceof</code> check. A more interesting example might
be a view. I assert that a view has an element, and render and remove methods. An interface class
for this might be:</p>
<pre><code class="lang-javascript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">View</span> </span>{
  <span class="hljs-keyword">constructor</span>() {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'View is an interface class.'</span>);
  }

  <span class="hljs-keyword">static</span> [<span class="hljs-built_in">Symbol</span>.hasInstance](value) {
    <span class="hljs-keyword">if</span> (!value) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value.render !== <span class="hljs-string">'function'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value.remove !== <span class="hljs-string">'function'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">return</span> value.element <span class="hljs-keyword">instanceof</span> HTMLElement;
  }
}
</code></pre>
<p>Now view objects can come from any source as long as they have render and remove methods and an
element. Objects which implement various interface classes also mean that these interface classes
don&#39;t have to be in the same prototype chain. In other words, it gives you a way to use <code>instanceof</code>
without invoking inheritance.</p>
<p>Sadly <code>hasInstance</code> will be one of the last ES2015 features to make it into browsers, so we&#39;ll have
to wait a while before we can use it. See
<a target="_blank" rel="noopener" href="http://kangax.github.io/compat-table/es6/#test-well-known_symbols_Symbol.hasInstance">the compatibility table</a>.</p>

      </div>
    </article>
    <footer>
      <p>Feel like sharing? <a target="_blank" rel="noopener" href="https://twitter.com/intent/tweet?via=qubyte&amp;text=Qubyte%20Codes%20-%20Interfaces%20for%20JavaScript&amp;url=https://qubyte.codes/blog/interfaces-for-javascript&amp;hashtags=JavaScript">Tweet this post!</a> or <a target="_blank" rel="noopener" href="web+mastodon://share?text=Qubyte%20Codes%20-%20Interfaces%20for%20JavaScript%20via%20%40qubyte%40mastodon.social%20%23JavaScript%20https%3A%2F%2Fqubyte.codes%2Fblog%2Finterfaces-for-javascript">toot it!</a></p>
      <p>Comments or corrections? <a target="_blank" rel="noopener" href="https://twitter.com/intent/tweet?screen_name=qubyte">Send me a tweet!</a> or <a target="_blank" rel="noopener" href="web+mastodon://share?text=%40qubyte%40mastodon.social">toot to me!</a></p>
    </footer>
  </div>
</body>
</html>
